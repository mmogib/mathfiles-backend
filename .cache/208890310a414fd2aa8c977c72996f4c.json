{"id":"akyj","dependencies":[{"name":"E:\\dev\\projects\\department\\mathfiles\\mathfiles-backend\\package.json","includedInParent":true,"mtime":1534490769265},{"name":"../models/CourseFile","loc":{"line":1,"column":27},"parent":"E:\\dev\\projects\\department\\mathfiles\\mathfiles-backend\\app\\files\\course_files.js","resolved":"E:\\dev\\projects\\department\\mathfiles\\mathfiles-backend\\app\\models\\CourseFile.js"},{"name":"./general","loc":{"line":2,"column":30},"parent":"E:\\dev\\projects\\department\\mathfiles\\mathfiles-backend\\app\\files\\course_files.js","resolved":"E:\\dev\\projects\\department\\mathfiles\\mathfiles-backend\\app\\files\\general.js"},{"name":"./logger","loc":{"line":3,"column":23},"parent":"E:\\dev\\projects\\department\\mathfiles\\mathfiles-backend\\app\\files\\course_files.js","resolved":"E:\\dev\\projects\\department\\mathfiles\\mathfiles-backend\\app\\files\\logger.js"}],"generated":{"js":"const e=require(\"../models/CourseFile\"),{saveFiles:s}=require(\"./general\"),r=require(\"./logger\");module.exports={getAllCourseFiles:()=>l(),async saveAllCourseFiles(){const e=await l();null!=e?s(\"course_files\",\"courseFiles\",JSON.stringify(e)):r.log(\"error\",\"No course files were retrieved and no files were saved ..\")}};const o=(e,s)=>e.findIndex(e=>e.course==s),l=()=>new Promise(s=>{e.findAll().then(e=>{let r=[];e.forEach(e=>{const{OFF_SEMESTER:s,OFF_COURSE:l,OFF_SECTION:u,OFF_EXAM:i,OFF_TYPE:n}=e,c=r.findIndex(e=>e.term==s),t={name:i,link:`${l}_${s}_${u}_${i}.${n}`};if(c<0)r.push({term:s,courses:[{course:l,exams:[t]}]});else{const e=o(r[c].courses,l);e<0?r[c].courses.push({course:l,exams:[t]}):r[c].courses[e].exams.push(t)}}),s(r)}).catch(()=>s(null))});","map":{"mappings":[{"source":"app\\files\\course_files.js","original":{"line":1,"column":0},"generated":{"line":1,"column":0}},{"source":"app\\files\\course_files.js","name":"CourseFile","original":{"line":1,"column":6},"generated":{"line":1,"column":6}},{"source":"app\\files\\course_files.js","name":"require","original":{"line":1,"column":19},"generated":{"line":1,"column":8}},{"source":"app\\files\\course_files.js","original":{"line":1,"column":27},"generated":{"line":1,"column":16}},{"source":"app\\files\\course_files.js","original":{"line":2,"column":6},"generated":{"line":1,"column":41}},{"source":"app\\files\\course_files.js","name":"saveFiles","original":{"line":2,"column":8},"generated":{"line":1,"column":51}},{"source":"app\\files\\course_files.js","name":"require","original":{"line":2,"column":22},"generated":{"line":1,"column":54}},{"source":"app\\files\\course_files.js","original":{"line":2,"column":30},"generated":{"line":1,"column":62}},{"source":"app\\files\\course_files.js","name":"logger","original":{"line":3,"column":6},"generated":{"line":1,"column":75}},{"source":"app\\files\\course_files.js","name":"require","original":{"line":3,"column":15},"generated":{"line":1,"column":77}},{"source":"app\\files\\course_files.js","original":{"line":3,"column":23},"generated":{"line":1,"column":85}},{"source":"app\\files\\course_files.js","name":"module","original":{"line":5,"column":0},"generated":{"line":1,"column":97}},{"source":"app\\files\\course_files.js","name":"exports","original":{"line":5,"column":7},"generated":{"line":1,"column":104}},{"source":"app\\files\\course_files.js","original":{"line":5,"column":17},"generated":{"line":1,"column":112}},{"source":"app\\files\\course_files.js","original":{"line":6,"column":22},"generated":{"line":1,"column":113}},{"source":"app\\files\\course_files.js","original":{"line":6,"column":22},"generated":{"line":1,"column":131}},{"source":"app\\files\\course_files.js","name":"_getAllCourseFiles","original":{"line":7,"column":11},"generated":{"line":1,"column":135}},{"source":"app\\files\\course_files.js","name":"saveAllCourseFiles","original":{"line":9,"column":8},"generated":{"line":1,"column":139}},{"source":"app\\files\\course_files.js","name":"list","original":{"line":10,"column":10},"generated":{"line":1,"column":166}},{"source":"app\\files\\course_files.js","name":"list","original":{"line":10,"column":10},"generated":{"line":1,"column":172}},{"source":"app\\files\\course_files.js","name":"_getAllCourseFiles","original":{"line":10,"column":23},"generated":{"line":1,"column":180}},{"source":"app\\files\\course_files.js","original":{"line":11,"column":16},"generated":{"line":1,"column":184}},{"source":"app\\files\\course_files.js","name":"list","original":{"line":11,"column":8},"generated":{"line":1,"column":190}},{"source":"app\\files\\course_files.js","original":{"line":12,"column":16},"generated":{"line":1,"column":192}},{"source":"app\\files\\course_files.js","original":{"line":12,"column":16},"generated":{"line":1,"column":194}},{"source":"app\\files\\course_files.js","original":{"line":12,"column":32},"generated":{"line":1,"column":209}},{"source":"app\\files\\course_files.js","name":"JSON","original":{"line":12,"column":47},"generated":{"line":1,"column":223}},{"source":"app\\files\\course_files.js","name":"stringify","original":{"line":12,"column":52},"generated":{"line":1,"column":228}},{"source":"app\\files\\course_files.js","name":"list","original":{"line":12,"column":62},"generated":{"line":1,"column":238}},{"source":"app\\files\\course_files.js","name":"log","original":{"line":14,"column":13},"generated":{"line":1,"column":242}},{"source":"app\\files\\course_files.js","name":"log","original":{"line":14,"column":13},"generated":{"line":1,"column":244}},{"source":"app\\files\\course_files.js","original":{"line":15,"column":8},"generated":{"line":1,"column":248}},{"source":"app\\files\\course_files.js","original":{"line":16,"column":8},"generated":{"line":1,"column":256}},{"source":"app\\files\\course_files.js","original":{"line":22,"column":0},"generated":{"line":1,"column":319}},{"source":"app\\files\\course_files.js","name":"_CoursesIncludeCourse","original":{"line":22,"column":6},"generated":{"line":1,"column":325}},{"source":"app\\files\\course_files.js","original":{"line":22,"column":30},"generated":{"line":1,"column":327}},{"source":"app\\files\\course_files.js","name":"courses","original":{"line":22,"column":31},"generated":{"line":1,"column":328}},{"source":"app\\files\\course_files.js","name":"course","original":{"line":22,"column":40},"generated":{"line":1,"column":330}},{"source":"app\\files\\course_files.js","name":"courses","original":{"line":23,"column":9},"generated":{"line":1,"column":334}},{"source":"app\\files\\course_files.js","name":"findIndex","original":{"line":23,"column":17},"generated":{"line":1,"column":336}},{"source":"app\\files\\course_files.js","name":"value","original":{"line":23,"column":27},"generated":{"line":1,"column":346}},{"source":"app\\files\\course_files.js","name":"value","original":{"line":23,"column":36},"generated":{"line":1,"column":349}},{"source":"app\\files\\course_files.js","name":"course","original":{"line":23,"column":42},"generated":{"line":1,"column":351}},{"source":"app\\files\\course_files.js","name":"course","original":{"line":23,"column":52},"generated":{"line":1,"column":359}},{"source":"app\\files\\course_files.js","name":"_getAllCourseFiles","original":{"line":26,"column":6},"generated":{"line":1,"column":362}},{"source":"app\\files\\course_files.js","original":{"line":26,"column":27},"generated":{"line":1,"column":364}},{"source":"app\\files\\course_files.js","original":{"line":27,"column":9},"generated":{"line":1,"column":368}},{"source":"app\\files\\course_files.js","name":"Promise","original":{"line":27,"column":13},"generated":{"line":1,"column":372}},{"source":"app\\files\\course_files.js","name":"resolve","original":{"line":27,"column":21},"generated":{"line":1,"column":380}},{"source":"app\\files\\course_files.js","name":"findAll","original":{"line":28,"column":15},"generated":{"line":1,"column":384}},{"source":"app\\files\\course_files.js","name":"findAll","original":{"line":28,"column":15},"generated":{"line":1,"column":386}},{"source":"app\\files\\course_files.js","name":"then","original":{"line":29,"column":7},"generated":{"line":1,"column":396}},{"source":"app\\files\\course_files.js","name":"rows","original":{"line":29,"column":12},"generated":{"line":1,"column":401}},{"source":"app\\files\\course_files.js","name":"list","original":{"line":30,"column":12},"generated":{"line":1,"column":405}},{"source":"app\\files\\course_files.js","name":"list","original":{"line":30,"column":12},"generated":{"line":1,"column":409}},{"source":"app\\files\\course_files.js","original":{"line":30,"column":19},"generated":{"line":1,"column":411}},{"source":"app\\files\\course_files.js","name":"forEach","original":{"line":31,"column":13},"generated":{"line":1,"column":414}},{"source":"app\\files\\course_files.js","name":"forEach","original":{"line":31,"column":13},"generated":{"line":1,"column":416}},{"source":"app\\files\\course_files.js","name":"row","original":{"line":31,"column":21},"generated":{"line":1,"column":424}},{"source":"app\\files\\course_files.js","original":{"line":32,"column":16},"generated":{"line":1,"column":428}},{"source":"app\\files\\course_files.js","name":"term","original":{"line":33,"column":26},"generated":{"line":1,"column":434}},{"source":"app\\files\\course_files.js","name":"term","original":{"line":33,"column":26},"generated":{"line":1,"column":447}},{"source":"app\\files\\course_files.js","name":"course","original":{"line":34,"column":24},"generated":{"line":1,"column":449}},{"source":"app\\files\\course_files.js","name":"course","original":{"line":34,"column":24},"generated":{"line":1,"column":460}},{"source":"app\\files\\course_files.js","name":"section","original":{"line":35,"column":25},"generated":{"line":1,"column":462}},{"source":"app\\files\\course_files.js","name":"section","original":{"line":35,"column":25},"generated":{"line":1,"column":474}},{"source":"app\\files\\course_files.js","name":"exam","original":{"line":36,"column":22},"generated":{"line":1,"column":476}},{"source":"app\\files\\course_files.js","name":"exam","original":{"line":36,"column":22},"generated":{"line":1,"column":485}},{"source":"app\\files\\course_files.js","name":"type","original":{"line":37,"column":22},"generated":{"line":1,"column":487}},{"source":"app\\files\\course_files.js","name":"type","original":{"line":37,"column":22},"generated":{"line":1,"column":496}},{"source":"app\\files\\course_files.js","name":"row","original":{"line":38,"column":14},"generated":{"line":1,"column":499}},{"source":"app\\files\\course_files.js","name":"foundTermIndex","original":{"line":39,"column":16},"generated":{"line":1,"column":501}},{"source":"app\\files\\course_files.js","name":"list","original":{"line":39,"column":33},"generated":{"line":1,"column":503}},{"source":"app\\files\\course_files.js","name":"findIndex","original":{"line":39,"column":38},"generated":{"line":1,"column":505}},{"source":"app\\files\\course_files.js","name":"value","original":{"line":39,"column":48},"generated":{"line":1,"column":515}},{"source":"app\\files\\course_files.js","name":"value","original":{"line":39,"column":57},"generated":{"line":1,"column":518}},{"source":"app\\files\\course_files.js","name":"term","original":{"line":39,"column":63},"generated":{"line":1,"column":520}},{"source":"app\\files\\course_files.js","name":"term","original":{"line":39,"column":71},"generated":{"line":1,"column":526}},{"source":"app\\files\\course_files.js","name":"file","original":{"line":40,"column":16},"generated":{"line":1,"column":529}},{"source":"app\\files\\course_files.js","original":{"line":40,"column":23},"generated":{"line":1,"column":531}},{"source":"app\\files\\course_files.js","name":"exam","original":{"line":41,"column":18},"generated":{"line":1,"column":532}},{"source":"app\\files\\course_files.js","name":"exam","original":{"line":41,"column":18},"generated":{"line":1,"column":537}},{"source":"app\\files\\course_files.js","original":{"line":42,"column":19},"generated":{"line":1,"column":539}},{"source":"app\\files\\course_files.js","name":"course","original":{"line":42,"column":21},"generated":{"line":1,"column":547}},{"source":"app\\files\\course_files.js","name":"term","original":{"line":42,"column":31},"generated":{"line":1,"column":552}},{"source":"app\\files\\course_files.js","name":"section","original":{"line":42,"column":39},"generated":{"line":1,"column":557}},{"source":"app\\files\\course_files.js","name":"exam","original":{"line":42,"column":50},"generated":{"line":1,"column":562}},{"source":"app\\files\\course_files.js","name":"type","original":{"line":42,"column":58},"generated":{"line":1,"column":567}},{"source":"app\\files\\course_files.js","name":"foundTermIndex","original":{"line":44,"column":14},"generated":{"line":1,"column":572}},{"source":"app\\files\\course_files.js","name":"foundTermIndex","original":{"line":44,"column":14},"generated":{"line":1,"column":575}},{"source":"app\\files\\course_files.js","original":{"line":44,"column":31},"generated":{"line":1,"column":577}},{"source":"app\\files\\course_files.js","name":"push","original":{"line":45,"column":17},"generated":{"line":1,"column":579}},{"source":"app\\files\\course_files.js","name":"push","original":{"line":45,"column":17},"generated":{"line":1,"column":581}},{"source":"app\\files\\course_files.js","original":{"line":45,"column":22},"generated":{"line":1,"column":586}},{"source":"app\\files\\course_files.js","original":{"line":45,"column":22},"generated":{"line":1,"column":587}},{"source":"app\\files\\course_files.js","original":{"line":45,"column":22},"generated":{"line":1,"column":592}},{"source":"app\\files\\course_files.js","original":{"line":47,"column":23},"generated":{"line":1,"column":594}},{"source":"app\\files\\course_files.js","original":{"line":47,"column":23},"generated":{"line":1,"column":602}},{"source":"app\\files\\course_files.js","original":{"line":47,"column":24},"generated":{"line":1,"column":603}},{"source":"app\\files\\course_files.js","name":"course","original":{"line":47,"column":26},"generated":{"line":1,"column":604}},{"source":"app\\files\\course_files.js","name":"course","original":{"line":47,"column":26},"generated":{"line":1,"column":611}},{"source":"app\\files\\course_files.js","name":"exams","original":{"line":47,"column":34},"generated":{"line":1,"column":613}},{"source":"app\\files\\course_files.js","original":{"line":47,"column":41},"generated":{"line":1,"column":619}},{"source":"app\\files\\course_files.js","name":"file","original":{"line":47,"column":42},"generated":{"line":1,"column":620}},{"source":"app\\files\\course_files.js","original":{"line":49,"column":17},"generated":{"line":1,"column":631}},{"source":"app\\files\\course_files.js","name":"courseIndex","original":{"line":50,"column":18},"generated":{"line":1,"column":632}},{"source":"app\\files\\course_files.js","name":"courseIndex","original":{"line":50,"column":18},"generated":{"line":1,"column":638}},{"source":"app\\files\\course_files.js","name":"_CoursesIncludeCourse","original":{"line":50,"column":32},"generated":{"line":1,"column":640}},{"source":"app\\files\\course_files.js","name":"list","original":{"line":51,"column":14},"generated":{"line":1,"column":642}},{"source":"app\\files\\course_files.js","name":"foundTermIndex","original":{"line":51,"column":19},"generated":{"line":1,"column":644}},{"source":"app\\files\\course_files.js","name":"courses","original":{"line":51,"column":35},"generated":{"line":1,"column":647}},{"source":"app\\files\\course_files.js","name":"course","original":{"line":52,"column":14},"generated":{"line":1,"column":655}},{"source":"app\\files\\course_files.js","name":"courseIndex","original":{"line":54,"column":16},"generated":{"line":1,"column":658}},{"source":"app\\files\\course_files.js","original":{"line":54,"column":30},"generated":{"line":1,"column":660}},{"source":"app\\files\\course_files.js","name":"foundTermIndex","original":{"line":55,"column":19},"generated":{"line":1,"column":662}},{"source":"app\\files\\course_files.js","name":"foundTermIndex","original":{"line":55,"column":19},"generated":{"line":1,"column":664}},{"source":"app\\files\\course_files.js","name":"courses","original":{"line":55,"column":35},"generated":{"line":1,"column":667}},{"source":"app\\files\\course_files.js","name":"push","original":{"line":55,"column":43},"generated":{"line":1,"column":675}},{"source":"app\\files\\course_files.js","original":{"line":55,"column":48},"generated":{"line":1,"column":680}},{"source":"app\\files\\course_files.js","original":{"line":55,"column":48},"generated":{"line":1,"column":681}},{"source":"app\\files\\course_files.js","original":{"line":55,"column":48},"generated":{"line":1,"column":688}},{"source":"app\\files\\course_files.js","original":{"line":57,"column":23},"generated":{"line":1,"column":690}},{"source":"app\\files\\course_files.js","original":{"line":57,"column":23},"generated":{"line":1,"column":696}},{"source":"app\\files\\course_files.js","name":"file","original":{"line":57,"column":24},"generated":{"line":1,"column":697}},{"source":"app\\files\\course_files.js","name":"foundTermIndex","original":{"line":60,"column":19},"generated":{"line":1,"column":702}},{"source":"app\\files\\course_files.js","name":"foundTermIndex","original":{"line":60,"column":19},"generated":{"line":1,"column":704}},{"source":"app\\files\\course_files.js","name":"courses","original":{"line":60,"column":35},"generated":{"line":1,"column":707}},{"source":"app\\files\\course_files.js","name":"courseIndex","original":{"line":60,"column":43},"generated":{"line":1,"column":715}},{"source":"app\\files\\course_files.js","original":{"line":60,"column":14},"generated":{"line":1,"column":718}},{"source":"app\\files\\course_files.js","name":"push","original":{"line":60,"column":65},"generated":{"line":1,"column":724}},{"source":"app\\files\\course_files.js","name":"file","original":{"line":60,"column":70},"generated":{"line":1,"column":729}},{"source":"app\\files\\course_files.js","name":"list","original":{"line":64,"column":16},"generated":{"line":1,"column":735}},{"source":"app\\files\\course_files.js","name":"list","original":{"line":64,"column":16},"generated":{"line":1,"column":737}},{"source":"app\\files\\course_files.js","name":"catch","original":{"line":66,"column":7},"generated":{"line":1,"column":742}},{"source":"app\\files\\course_files.js","original":{"line":66,"column":13},"generated":{"line":1,"column":748}},{"source":"app\\files\\course_files.js","name":"resolve","original":{"line":66,"column":19},"generated":{"line":1,"column":752}},{"source":"app\\files\\course_files.js","original":{"line":66,"column":27},"generated":{"line":1,"column":754}}],"sources":{"app\\files\\course_files.js":"const CourseFile = require('../models/CourseFile')\r\nconst { saveFiles } = require('./general')\r\nconst logger = require('./logger')\r\n\r\nmodule.exports = {\r\n  getAllCourseFiles() {\r\n    return _getAllCourseFiles()\r\n  },\r\n  async saveAllCourseFiles() {\r\n    const list = await _getAllCourseFiles()\r\n    if (list != null) {\r\n      saveFiles('course_files', 'courseFiles', JSON.stringify(list))\r\n    } else {\r\n      logger.log(\r\n        'error',\r\n        'No course files were retrieved and no files were saved ..'\r\n      )\r\n    }\r\n  }\r\n}\r\n\r\nconst _CoursesIncludeCourse = (courses, course) => {\r\n  return courses.findIndex(value => value.course == course)\r\n}\r\n\r\nconst _getAllCourseFiles = () => {\r\n  return new Promise(resolve => {\r\n    CourseFile.findAll()\r\n      .then(rows => {\r\n        let list = []\r\n        rows.forEach(row => {\r\n          const {\r\n            OFF_SEMESTER: term,\r\n            OFF_COURSE: course,\r\n            OFF_SECTION: section,\r\n            OFF_EXAM: exam,\r\n            OFF_TYPE: type\r\n          } = row\r\n          const foundTermIndex = list.findIndex(value => value.term == term)\r\n          const file = {\r\n            name: exam,\r\n            link: `${course}_${term}_${section}_${exam}.${type}`\r\n          }\r\n          if (foundTermIndex < 0) {\r\n            list.push({\r\n              term,\r\n              courses: [{ course, exams: [file] }]\r\n            })\r\n          } else {\r\n            const courseIndex = _CoursesIncludeCourse(\r\n              list[foundTermIndex].courses,\r\n              course\r\n            )\r\n            if (courseIndex < 0) {\r\n              list[foundTermIndex].courses.push({\r\n                course,\r\n                exams: [file]\r\n              })\r\n            } else {\r\n              list[foundTermIndex].courses[courseIndex]['exams'].push(file)\r\n            }\r\n          }\r\n        })\r\n        resolve(list)\r\n      })\r\n      .catch(() => resolve(null))\r\n  })\r\n}\r\n"},"lineCount":null}},"hash":"695f8585782e3fa45db7e06074143aca","cacheData":{"env":{}}}